name: Rightsize my deployment my latest version

on: 
  push: # What triggers a deployment. For example, `push`.
    branches:
      - main # What branch triggers a deployment. For example, `main`.   
jobs:
  rightSize:
    name: Calls the callback being passed in
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: getSizingApiResponse
        id: getToken
        uses: fjogeleit/http-request-action@master
        with:
          url: "http://a6299b5747b7b4a698f4098a263ea0a7-1252398275.us-east-2.elb.amazonaws.com:9090/model/savings/requestSizing?filterNamespaces=borealis-prod&filterContainer=potato-facts&algorithm=max-headroom"
          method: "GET"
      - name: extract CPU sizing
        uses: sergeysova/jq-action@v2
        id: cpuSizing
        with:
          cmd: 'jq [.controllers[].target.cpuCores]|max -r'
